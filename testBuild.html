<!DOCTYPE html>
<html>
<head></head>
<body>

	<div id="content">
	</div>

	<div id="confirm">
		<input type="submit">
		<input type="reset">
	</div>

	<script src="lib/jquery.1.11.1.min.js"></script>

	<script src="script/equips.js"></script>
	<script src="script/remodelEquips.js"></script>
	<script>
		var categoryNames = ['小口径主砲', '中口径主砲', '大口径主砲', '魚雷', '反潛裝備', '特種裝備'];

        var tar = document.getElementById('content');

        for(var i in categoryNames) {
       		var category = new Category(categoryNames[i]);
       		var dom = category.build();

        	tar.appendChild(dom);
        }


        var checkedEquips, availiableEquips;
        function report() {
        	checkedEquips = [];
            availiableEquips = [];
        	var now = new Date();

        	var today = now.getDay();
            var tomorrow = today + 1;
        	
        	$('input:checked').each(function() {
        		var name = this.value;
        		checkedEquips.push(name);

        		var assistShips = canRemodelToday(name);
                if(assistShips.length > 0) {
                    var o = {};
                    o.name = name;
                    o.assistShips = assistShips;
                    availiableEquips.push(o);
                }
        	});



        	console.log('已勾选装备 :\n\t' + checkedEquips.join('\n\t'));
            console.log('可改修装备 :\n\t' + generateAssistShipsReport(availiableEquips));

            /*
             *  根据'装备名称', 计算该装备今天是否能够改修
             *  如果能够改修, 将二号舰的名称, 以及对应的装备名称封装起来返回
             */
        	function canRemodelToday(name) {
        		var equip = kanColle.remodel.extractEquip(name);
        		var remodelDetails = equip.detail;

        		var assistShips = [];

                /*
                 *  Equip(*name*)之中的details部分, 可能拥有多个符合判定条件的船只, 因此使用Loop方式进行逐个检查
                 */
        		for(var i in remodelDetails) {

        			var d = remodelDetails[i];

        			if($.inArray(today, d.enableDays) > -1) {

                        var assistShip = d.assistant;

                        if(assistShip === '-') {
                            assistShip = '无需协助舰娘';
                        }

						assistShips.push(assistShip);
        			}
        		}

        		return assistShips.join(', ');
        	}

            function generateAssistShipsReport(array) {

                if(array.length === 0) {
                    return '今日没有可以改修的装备';
                }

                var title = '可改修装备有 ' + array.length + ' 个\n';

                var content = [];
                for(var i in array) {

                    var arr = array[i];
                    var name = arr.name;
                    var ships = arr.assistShips;

                    var oneLineText = '\t' + name + '\t' + ships;
                    content.push(oneLineText);
                }

                var sum = title + content.join('\n');

                return sum;
            }
        }

        $('input[type=checkbox]').on('change', report);
		
	</script>
</body>
</html>